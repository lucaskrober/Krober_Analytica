setwd("~/Documents/UFSCAR/2014/11º semestre/Manejo de Plantadas/Trabalhos/Trabalho Final")
dados=read.csv2("dados_prog.csv");
library(cmrinvflor);
dados_pareados=parear_seqmed(subset(dados,,c("parcela","id","vtcc","ab","S")));     #dados = parear dados só as columas; parcela= variavel estatisticadora; id= variavel que coloca em ordem crescente; vtcc,ab,S= demais colunas( não tem necessidade de parear o sitio, pq é igual, só coloca p aparecer na tabela)
names(dados);
dados_pareados=parear_seqmed(subset(dados,,c("parcela","id","vtcc","ab","S")));     #dados = parear dados só as columas; parcela= variavel estatisticadora; id= variavel que coloca em ordem crescente; vtcc,ab,S= demais colunas( não tem necessidade de parear o sitio, pq é igual, só coloca p aparecer na tabela)
dados=read.csv2("dados_prog.csv");
library(cmrinvflor);
dados_pareados=parear_seqmed(subset(dados,,c("parcela","id","vtcc","ab","S")));     #dados = parear dados só as columas; parcela= variavel estatisticadora; id= variavel que coloca em ordem crescente; vtcc,ab,S= demais colunas( não tem necessidade de parear o sitio, pq é igual, só coloca p aparecer na tabela)
dados=read.csv2("dados_prog.csv");
View(dados);
names(dados);
dados=read.csv2("dados_prog.csv");
library(cmrinvflor);
dados_pareados=parear_seqmed(subset(dados,,c("parcela","id","vtcc","ab","S")));     #dados = parear dados só as columas; parcela= variavel estatisticadora; id= variavel que coloca em ordem crescente; vtcc,ab,S= demais colunas( não tem necessidade de parear o sitio, pq é igual, só coloca p aparecer na tabela)
dados_pareados$S=dados_pareados$S2
dados_pareados$S1=NULL;             #apagar as colunas
dados_pareados$S2=NULL;             #apagar as colunas
View(dados_pareados);
modelo="log(vtcc2)~I(1/S)+I(1/id2)+I((id1/id2)*log(ab1))+I(1-id1/id2)+I((1-id1/id2)*S)";    #1/S=variaveis do model
aj_clutter=lm(modelo,dados_pareados);
summary(aj_clutter);    #R²=0,9447 é ótimo!
anova(aj_clutter);
vest=exp(predict(aj_clutter)); vest; #predic=di/dap
sqerro=sum((dados_pareados$vtcc2-vest)^2);
narvore=nrow(dados); narvore;
coefs=as.vector(coef(aj_clutter));coefs;
glreg=length(coefs)-1; glreg;
qme=sqerro/(narvore-glreg-1); qme;
erropadres=sqrt(qme);erropadres;
erroperc=erropadres/mean(dados_pareados$vtcc2)*100; erroperc;
################Análise Gráfica do ajuste
dados_pareados$vtcc2est=exp(predict(aj_clutter));
residuos=dados_pareados$vtcc2-dados_pareados$vtcc2est;
dados_pareados$erropad=residuos/erropadres;
par(mfrow=c(1,3));
X11();
par(mfrow=c(1,3));
plot(dados_pareados$id2 , dados_pareados$vtcc2 , pch="*", col="blue", xlab="Idade (meses)", ylab="vtcc (m³)", main="Modelo de Clutter") ;
points(dados_pareados$id2, dados_pareados$vtcc2est, pch="*", col="red") ;
legend("bottomright", legend=c("vtcc2_obs", "vtcc2_est"), pch="*", col=c("blue","red"));
plot(dados_pareados$id2 , dados_pareados$erropad, pch="*", col="blue", xlab="Idade (meses)", ylab="Resíduos padronizados", ylim=c(-4,4)) ;
abline(h=0, lty=4, lwd=2);
t_valor=qt(0.995,nrow(dados)-1) ;
abline(h=t_valor, lty=3, lwd=2);
abline(h=-t_valor, lty=3, lwd=2);
hist(residuos, xlab="Resíduos (m)", ylab="Frequência", main="",col='blue',bg="red");
(bs=as.vector(coef(aj_clutter)));       #bs=betas
ultmed=aggregate(list(max_id=dados$id),list(parcela=dados$parcela),max)   ;  #ultimed é pra pegar a ultima medição
View(ultmed);
dados=merge(dados,ultmed);     # juntou os dois arquivos
dados_ultmed=subset(dados,id==max_id);   # Pegar os dados da máx id (selecionar a ultima medição)
idadeprog=24;      #(24 meses=2anos)
dados_ultmed$vtcc2=with(dados_ultmed, exp(bs[1]+bs[2]/S+bs[3]/idadeprog+bs[4]*(id/idadeprog)*log(ab)+bs[5]*(1-id/idadeprog)+bs[6]*(1-id/idadeprog)*S)); #bs é valores de betas, guardou-os na posição 1,2,.. pq no R a matriz começa na posição 1! igual no excel, só q não devia.
idadeprog=36;
dados_ultmed$vtcc3=with(dados_ultmed, exp(bs[1]+bs[2]/S+bs[3]/idadeprog+bs[4]*(id/idadeprog)*log(ab)+bs[5]*(1-id/idadeprog)+bs[6]*(1-id/idadeprog)*S));
idadeprog=48;
dados_ultmed$vtcc4=with(dados_ultmed, exp(bs[1]+bs[2]/S+bs[3]/idadeprog+bs[4]*(id/idadeprog)*log(ab)+bs[5]*(1-id/idadeprog)+bs[6]*(1-id/idadeprog)*S));
idadeprog=60;
dados_ultmed$vtcc5=with(dados_ultmed, exp(bs[1]+bs[2]/S+bs[3]/idadeprog+bs[4]*(id/idadeprog)*log(ab)+bs[5]*(1-id/idadeprog)+bs[6]*(1-id/idadeprog)*S));
idadeprog=72;
dados_ultmed$vtcc6=with(dados_ultmed, exp(bs[1]+bs[2]/S+bs[3]/idadeprog+bs[4]*(id/idadeprog)*log(ab)+bs[5]*(1-id/idadeprog)+bs[6]*(1-id/idadeprog)*S));
idadeprog=84;
dados_ultmed$vtcc7=with(dados_ultmed, exp(bs[1]+bs[2]/S+bs[3]/idadeprog+bs[4]*(id/idadeprog)*log(ab)+bs[5]*(1-id/idadeprog)+bs[6]*(1-id/idadeprog)*S));
idadeprog=96;
dados_ultmed$vtcc8=with(dados_ultmed, exp(bs[1]+bs[2]/S+bs[3]/idadeprog+bs[4]*(id/idadeprog)*log(ab)+bs[5]*(1-id/idadeprog)+bs[6]*(1-id/idadeprog)*S));
idadeprog=108;
dados_ultmed$vtcc9=with(dados_ultmed, exp(bs[1]+bs[2]/S+bs[3]/idadeprog+bs[4]*(id/idadeprog)*log(ab)+bs[5]*(1-id/idadeprog)+bs[6]*(1-id/idadeprog)*S));
idadeprog=120;
dados_ultmed$vtcc10=with(dados_ultmed, exp(bs[1]+bs[2]/S+bs[3]/idadeprog+bs[4]*(id/idadeprog)*log(ab)+bs[5]*(1-id/idadeprog)+bs[6]*(1-id/idadeprog)*S));
View(ultmed)
dados_ultmed$ima2=dados_ultmed$vtcc2/2;
dados_ultmed$ima3=dados_ultmed$vtcc3/3;
dados_ultmed$ima4=dados_ultmed$vtcc4/4;
dados_ultmed$ima5=dados_ultmed$vtcc5/5;
dados_ultmed$ima6=dados_ultmed$vtcc6/6;
dados_ultmed$ima7=dados_ultmed$vtcc7/7;
dados_ultmed$ima8=dados_ultmed$vtcc8/8;
dados_ultmed$ima9=dados_ultmed$vtcc9/9;
dados_ultmed$ima10=dados_ultmed$vtcc10/10;
View(dados_ultmed);
#Calcular ICAs
dados_ultmed$ica3=with(dados_ultmed,vtcc3-vtcc2);
dados_ultmed$ica4=with(dados_ultmed,vtcc4-vtcc3);
dados_ultmed$ica5=with(dados_ultmed,vtcc5-vtcc4);
dados_ultmed$ica6=with(dados_ultmed,vtcc6-vtcc5);
dados_ultmed$ica7=with(dados_ultmed,vtcc7-vtcc6);
dados_ultmed$ica8=with(dados_ultmed,vtcc8-vtcc7);
dados_ultmed$ica9=with(dados_ultmed,vtcc9-vtcc8);
dados_ultmed$ica10=with(dados_ultmed,vtcc10-vtcc9);
View(dados_ultmed);
write.csv2(dados_ultmed,"prognose.csv", row.names=F);
summary(aj_clutter);    #R²=0,9535 é ótimo!
b0=2.31634;
b1=-11.502870;
b2= -19.06110;
b3=1.24286;
b4=4.11035;
b5= 0.02501;
id1=68.53; #idade
ab1=20.50980857; #area basal
s=25.5;   #sitio
eqvol=expression(exp(b0+b1/s+b2/x+b3*(id1/x)*log(ab1)+b4*(1-id1/x)+b5*(1-id1/x)*s));
D(eqvol,"x");
der.eqvol=expression(exp(b0 + b1/s + b2/x + b3 * (id1/x) * log(ab1) + b4 * (1 - id1/x) +
b5 * (1 - id1/x) * s) * (b4 * (id1/x^2) - (b3 * (id1/x^2) *
log(ab1) + b2/x^2) + b5 * (id1/x^2) * s));                #copiar a formula do D(eqvol)
vtcc=function(x){eval(eqvol)}
ica=function(x){eval(der.eqvol)}
ima=function(x){vtcc(x)/x}
vtcc(50);
fo=function(x){abs(ima(x)-ica(x))}
op=optimize(f=fo, interval=c(12,120));
(ioc=op$minimum);
par(mfrow=c(2,1));
curve(vtcc(x),12,120,col="red",xlab="idade(meses)", ylab="vtcc(m³/ha)");    #gráfico 1
x11();
par(mfrow=c(2,1));
curve(vtcc(x),12,120,col="red",xlab="idade(meses)", ylab="vtcc(m³/ha)");    #gráfico 1
abline(v=ioc, lty=2);                                                       #mostrar linha da idade otima de corte
curve(ica(x)*12,12,120,col="blue",xlab="idade(meses)", ylab="incremento(m³/ha.ano)");
abline(v=ioc, lty=2);
text(ioc,ima(ioc)*12,paste(round(ioc/12,2),"anos",sep=" ")) ;
curve(ima(x)*12,12,120,col="green" ,xlab="idade(meses)", ylab="incremento(m³/ha.ano)",add=T);
x11();
par(mfrow=c(2,1));
curve(vtcc(x),12,120,col="red",xlab="idade(meses)", ylab="vtcc(m³/ha)");    #gráfico 1
abline(v=ioc, lty=2);                                                       #mostrar linha da idade otima de corte
curve(ica(x)*12,12,120,col="blue",xlab="idade(meses)", ylab="incremento(m³/ha.ano)");
abline(v=ioc, lty=2);
text(ioc,ima(ioc)*12,paste(round(ioc/12,2),"anos",sep=" ")) ;
curve(ima(x)*12,12,120,col="green" ,xlab="idade(meses)", ylab="incremento(m³/ha.ano)",add=T);
#send selection até aqui
id1=69.38; #idade
ab1=34.9293683; #area basal
s=28,5;   #sitio
s=28.5;   #sitio
eqvol=expression(exp(b0+b1/s+b2/x+b3*(id1/x)*log(ab1)+b4*(1-id1/x)+b5*(1-id1/x)*s));
D(eqvol,"x");
der.eqvol=expression(exp(b0 + b1/s + b2/x + b3 * (id1/x) * log(ab1) + b4 * (1 - id1/x) +
b5 * (1 - id1/x) * s) * (b4 * (id1/x^2) - (b3 * (id1/x^2) *
log(ab1) + b2/x^2) + b5 * (id1/x^2) * s));                #copiar a formula do D(eqvol)
vtcc=function(x){eval(eqvol)}
ica=function(x){eval(der.eqvol)}
ima=function(x){vtcc(x)/x}
vtcc(50);
fo=function(x){abs(ima(x)-ica(x))}
op=optimize(f=fo, interval=c(12,120));
#idade ótima de corte
(ioc=op$minimum);
x11();
par(mfrow=c(2,1));
curve(vtcc(x),12,120,col="red",xlab="idade(meses)", ylab="vtcc(m³/ha)");    #gráfico 1
abline(v=ioc, lty=2);                                                       #mostrar linha da idade otima de corte
curve(ica(x)*12,12,120,col="blue",xlab="idade(meses)", ylab="incremento(m³/ha.ano)");
abline(v=ioc, lty=2);
text(ioc,ima(ioc)*12,paste(round(ioc/12,2),"anos",sep=" ")) ;
curve(ima(x)*12,12,120,col="green" ,xlab="idade(meses)", ylab="incremento(m³/ha.ano)",add=T);
#send selection até aqui
#a analise grafica do melhor  mostra que o espaçamento deveria ser maior, pois o ica máximo ocorre muito cedo(~2anos)
#a analise grafica do pior sitio mostra que o melhor é cortar na idade ótima de corte
id1=59.72; #idade
ab1=35,33737517; #area basal
s=31.5;   #sitio
id1=59.72; #idade
ab1=35.33737517; #area basal
s=31.5;   #sitio
eqvol=expression(exp(b0+b1/s+b2/x+b3*(id1/x)*log(ab1)+b4*(1-id1/x)+b5*(1-id1/x)*s));
#Derivada da equação do volume
D(eqvol,"x");
#Montagem da expressão
der.eqvol=expression(exp(b0 + b1/s + b2/x + b3 * (id1/x) * log(ab1) + b4 * (1 - id1/x) +
b5 * (1 - id1/x) * s) * (b4 * (id1/x^2) - (b3 * (id1/x^2) *
log(ab1) + b2/x^2) + b5 * (id1/x^2) * s));                #copiar a formula do D(eqvol)
#Para dar os valores de x
vtcc=function(x){eval(eqvol)}
ica=function(x){eval(der.eqvol)}
ima=function(x){vtcc(x)/x}
#teste
vtcc(50);
#fo=função objetiva
fo=function(x){abs(ima(x)-ica(x))}
#otimização da função objetiva variando o x de 12 a 120 meses
op=optimize(f=fo, interval=c(12,120));
#idade ótima de corte
(ioc=op$minimum);
#gráficos
x11();
par(mfrow=c(2,1));
curve(vtcc(x),12,120,col="red",xlab="idade(meses)", ylab="vtcc(m³/ha)");    #gráfico 1
abline(v=ioc, lty=2);                                                       #mostrar linha da idade otima de corte
curve(ica(x)*12,12,120,col="blue",xlab="idade(meses)", ylab="incremento(m³/ha.ano)");
abline(v=ioc, lty=2);
text(ioc,ima(ioc)*12,paste(round(ioc/12,2),"anos",sep=" ")) ;
curve(ima(x)*12,12,120,col="green" ,xlab="idade(meses)", ylab="incremento(m³/ha.ano)",add=T);
#send selection até aqui
dados_npar=read.csv2('dados_ra.csv')
dados_npar=subset(dados_npar,estrato==573116);
View(dados_npar)
setwd("~/UFSCar2015.1/Manejo de plantadas/Trabalho FINAL/Chapman & Richards Poli")
dados_npar=read.csv2('dados_ra.csv')
dados_npar=subset(dados_npar,estrato==573116);
View(dados_npar)
library(cmrinvflor)
dados=parear_seqmed(
dados_npar[,c('parcela','id','hd','ab','vtcc')]);
modelo='hd2~b0*(hd1/b0)^(log(1-exp(b1*id2))/log(1-exp(b1*id1)))';
aj_chap_poli=nls(modelo,data=dados,start=list(b0=35.95,b1=-0.023436));
sumário_ajchapp=summary(aj_chap_poli);
(sumario=summary(aj_chap_poli));
hdest2=predict(aj_chap_poli);
errounid=residuals(aj_chap_poli);
erroperc=(errounid/dados$hd2)*100;
erropad=errounid/sumário_ajchapp$sigma;
nsyx=round(sumário_ajchapp$sigma,5);nsyx;
print(paste('Erro padrão residual (m):',nsyx=round(sumário_ajchapp$sigma,5)));
print(paste('Erro padrão residual em porcentagem (%):', nsyx=round((sumário_ajchapp$sigma/mean(dados$hd2))*100,5)))
dados=read.csv2('dados_ra.csv');
dados=subset(dados,estrato==573116);
betas=sumário_ajchapp$coefficients
b0=betas[1];b0;
b1=betas[2];b1;
idref=72; #Idade de referência
dados$sitio=with(dados, b0*(hd/b0)^(log(1-exp(b1*idref))/log(1-exp(b1*id))));
(ls=max(dados$sitio));
(li=min(dados$sitio));
nls=31
nli=22
nclasses=4
(interv=(nls-nli)/nclasses);
setwd("~/UFSCar2015.1/Manejo de plantadas/Trabalho FINAL/Chapman & Richards Poli")
dados_npar=read.csv2('dados_ra.csv')
dados_npar=subset(dados_npar,estrato==573116);
library(cmrinvflor)
dados=parear_seqmed(
dados_npar[,c('parcela','id','hd','ab','vtcc')]);
modelo='hd2~b0*(hd1/b0)^(log(1-exp(b1*id2))/log(1-exp(b1*id1)))';
aj_chap_poli=nls(modelo,data=dados,start=list(b0=35.95,b1=-0.023436));
dados=read.csv2('dados_ra.csv');
dados=subset(dados,estrato==573116);
betas=sumário_ajchapp$coefficients
b0=betas[1];b0;
b1=betas[2];b1;
sumário_ajchapp=summary(aj_chap_poli);
(sumario=summary(aj_chap_poli));
dados=read.csv2('dados_ra.csv');
dados=subset(dados,estrato==573116);
betas=sumário_ajchapp$coefficients
b0=betas[1];b0;
b1=betas[2];b1;
idref=72; #Idade de referência
dados$sitio=with(dados, b0*(hd/b0)^(log(1-exp(b1*idref))/log(1-exp(b1*id))));
View(dados)
(ls=max(dados$sitio));
(li=min(dados$sitio));
nls=31
nli=22
nclasses=4
(interv=(nls-nli)/nclasses);
nls=31
nli=22
nclasses=4
(interv=(nls-nli)/nclasses);
setwd("C:/Users/LuizPaulo/Desktop/UFSCar/Manejo de plantadas/Manejo (LP)/Trabalho final alessandro/Trabalho FINAL/1 - Ajuste Modelos/Chapman & Richards Poli")
dados_npar=read.csv2('dados_ra.csv')
dados_npar=subset(dados_npar,estrato==573116);
library(cmrinvflor)
dados=parear_seqmed(
dados_npar[,c('parcela','id','hd','ab','vtcc')]);
with(dados_npar,plot(hd,vtcc,pch='*',col='green'));
modelo='hd2~b0*(hd1/b0)^(log(1-exp(b1*id2))/log(1-exp(b1*id1)))';
aj_chap_poli=nls(modelo,data=dados,start=list(b0=35.95,b1=-0.023436));
sumário_ajchapp=summary(aj_chap_poli);
(sumario=summary(aj_chap_poli));
hdest2=predict(aj_chap_poli);
errounid=residuals(aj_chap_poli);
erroperc=(errounid/dados$hd2)*100;
erropad=errounid/sumário_ajchapp$sigma;
nsyx=round(sumário_ajchapp$sigma,5);nsyx;
print(paste('Erro padrão residual (m):',nsyx=round(sumário_ajchapp$sigma,5)));
print(paste('Erro padrão residual em porcentagem (%):', nsyx=round((sumário_ajchapp$sigma/mean(dados$hd2))*100,5)))
setwd("C:/Faculdade/9º semestre/Plantadas/trabalho final/2016/Trabalho final alessandro/Trabalho FINAL/1 - Ajuste Modelos/Chapman & Richards Poli")
dados_npar=read.csv2('dados_ra.csv')
dados_npar=subset(dados_npar,estrato==494631);
dados_npar=read.csv2('dados_ra.csv')
dados_npar=subset(dados_npar,estrato==494631);
library(cmrinvflor)
dados=parear_seqmed(
dados_npar[,c('parcela','id','hd','ab','vtcc')]);
with(dados_npar,plot(hd,vtcc,pch='*',col='green'));
modelo='hd2~b0*(hd1/b0)^(log(1-exp(b1*id2))/log(1-exp(b1*id1)))';
aj_chap_poli=nls(modelo,data=dados,start=list(b0=35.95,b1=-0.023436));
sumário_ajchapp=summary(aj_chap_poli);
(sumario=summary(aj_chap_poli));
hdest2=predict(aj_chap_poli);
errounid=residuals(aj_chap_poli);
erroperc=(errounid/dados$hd2)*100;
erropad=errounid/sumário_ajchapp$sigma;
nsyx=round(sumário_ajchapp$sigma,5);nsyx;
print(paste('Erro padrão residual (m):',nsyx=round(sumário_ajchapp$sigma,5)));
print(paste('Erro padrão residual em porcentagem (%):', nsyx=round((sumário_ajchapp$sigma/mean(dados$hd2))*100,5)))
x11()
par(mfrow=c(1,3))
plot(predict(aj_chap_poli),residuals(aj_chap_poli),pch='*',
col='orange',xlab='hdom estimado (m)',
ylab='resíduos (m)', ylim=c(-5,5));
abline(h=0);
hist(residuals(aj_chap_poli),xlab='resíduos(m)',ylab='frequência',main='',col='orange');
plot(dados$id2,predict(aj_chap_poli),pch='*',col='orange',
xlab='idade(meses)', ylab='altura dominante');
points(dados$id2,dados$hd2,pch='*',col='black');
library(fBasics); #grafico quantil quantil para análise de Normalidade dos residuos
qqnormPlot(residuals(aj_chap_poli));
dados=read.csv2('dados_ra.csv');
dados=subset(dados,estrato==494631);
betas=sumário_ajchapp$coefficients
b0=betas[1];b0;
b1=betas[2];b1;
idref=72; #Idade de referência
dados$sitio=with(dados, b0*(hd/b0)^(log(1-exp(b1*idref))/log(1-exp(b1*id))));
(ls=max(dados$sitio));
(li=min(dados$sitio));
setwd("D:/Faculdade/9º semestre/Plantadas/Aulas/Aula 3")
library(cmrinvflor)
dados=read.csv2('dados_nao_pareados.csv')
names(dados)
#selecionar as colunas pare "arrumar" o arvivo para a biblioteca
seldados=dados[,c('parcela','idade','hdom')]
names(seldados)=c('idamostra','idade1','hdom1')
names(seldados)
coefs=data.frame(b0=51.58352,b2=0.77542)
idref=72
modelo='b0*((hdom1/b0)^((idade1/idade2)^b2))'
x11()
cls=class_sitio_dif_alg(seldados,modelo,coefs,idref,graf_curvas=T)
modelo=expression(b0*((hdom1/b0)^((idade1/idade2)^b2)))
x11()
cls=class_sitio_dif_alg(seldados,modelo,coefs,idref,graf_curvas=T)
modelo='hd2~b0*(hd1/b0)^(log(1-exp(b1*id2))/log(1-exp(b1*id1)))';
aj_chap_poli=nls(modelo,data=dados,start=list(b0=35.95,b1=-0.023436));
#ª Opção: Importação dos dados não pareados
dados_npar=read.csv2('dados_ra.csv')
setwd("D:/Faculdade/9º semestre/Plantadas/trabalho final/2016/Trabalho final alessandro/Trabalho FINAL/1 - Ajuste Modelos/Chapman & Richards Poli")
#ª Opção: Importação dos dados não pareados
dados_npar=read.csv2('dados_ra.csv')
dados_npar=subset(dados_npar,estrato==494631);
library(cmrinvflor)
dados=parear_seqmed(
dados_npar[,c('parcela','id','hd','ab','vtcc')]);
modelo='hd2~b0*(hd1/b0)^(log(1-exp(b1*id2))/log(1-exp(b1*id1)))';
aj_chap_poli=nls(modelo,data=dados,start=list(b0=35.95,b1=-0.023436));
sumário_ajchapp=summary(aj_chap_poli);
(sumario=summary(aj_chap_poli));
?cmrinvflor
?cmrinvflor-package
